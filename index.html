<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <link href="https://cdn.bootcss.com/semantic-ui/2.4.1/semantic.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/semantic-ui/2.4.1/semantic.min.js"></script>

    <script src="https://unpkg.com/konva@3.3.3/konva.min.js"></script>
    <meta charset="utf-8" />
    <title>Modelerjs Demo</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f0f0;
        }

        #toolbar {
            position: absolute;
            top: 0;
            right: 0;
            z-index: 1000;
            display: inline-flex;
        }

        #toolbar>.dropdown {
            margin: 1rem 10px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

    </style>
</head>

<body>
    <div id="container"></div>
    <div id="toolbar" class="ui toolbar inline">
        <div class="ui selection dropdown database">
            <input type="hidden" name="database">
            <i class="dropdown icon"></i>
            <div class="default text">数据库</div>
            <div class="menu">
                <div class="item" data-value="OWL-DEV">OWL-DEV</div>
                <div class="item" data-value="ZOOGUARD-DEV">ZOOGUARD-DEV</div>
            </div>
        </div>
        <div class="ui selection dropdown schemas">
            <input type="hidden" name="schema">
            <i class="dropdown icon"></i>
            <div class="default text">Schema</div>
            <div class="menu">
                <div class="item" data-value="etl">etl</div>
                <div class="item" data-value="etl">owl</div>
                <div class="item" data-value="etl">stg</div>
            </div>
        </div>
        <div class="ui selection dropdown tables">
            <input type="hidden" name="table">
            <i class="dropdown icon"></i>
            <div class="default text">Table</div>
            <div class="menu">
                <div class="item" data-value="history_data">history_data</div>
                <div class="item" data-value="device_report_data">device_report_data</div>
            </div>
        </div>

        <div class="ui teal menu" style="height: 18px; margin-right: 5px;">
            <div class="ui simple dropdown item">
                Change
                <i class="dropdown icon"></i>
                <div class="menu">
                    <div class="item add-table">添加</div>
                    <div class="item drop-table">删除</div>
                    <div class="item save">保存</div>
                </div>
            </div>
        </div>

    </div>
    </div>
    <script type="module">
        import { Designer } from "./js/designer.js";
        var designer;
        window.onload = function () {
            $('.ui.dropdown').dropdown();
            designer = new Designer("container");
            let table = designer.createTable("chr.history_data");
            let cellContent = [
                ["data_time", "timestamp(6)", "Y"],
                ["mn_code", "varchar(100)", "Y"],
                ["data_value", "numeric(12,5)", "N"]
            ];
            for (let i = 0; i < 3; i++) {
                table.addRow(...cellContent[i])
            };

            table = designer.createTable("rpt.owl_device_hour", 200, 300);
            cellContent = [
                ["data_time", "timestamp(6)", "Y"],
                ["device_id", "varchar(100)", "Y"],
                ["data_value", "numeric(12,5)", "N"]
            ];
            for (let i = 0; i < 3; i++) {
                table.addRow(...cellContent[i])
            };

            designer.createRelation("chr.history_data", ["data_time", "data_value"], "rpt.owl_device_hour", [
                "data_time", "data_value"
            ], 0)

            table = designer.createTable("rpt.owl_enterprise_hour", 200, 500);
            cellContent = [
                ["data_time", "timestamp(6)", "Y"],
                ["enterprise_code", "varchar(100)", "Y"],
                ["data_value", "numeric(12,5)", "N"]
            ];
            for (let i = 0; i < 3; i++) {
                table.addRow(...cellContent[i])
            };

            designer.createRelation("rpt.owl_enterprise_hour", ["data_time", "data_value"], "rpt.owl_device_hour", [
                "data_time", "data_value"
            ])

            designer.flush();

            $(".add-table").click(function(){
                table = designer.createTable("rpt.owl_district_hour", 600, 500);
                cellContent = [
                    ["data_time", "timestamp(6)", "Y"],
                    ["district_code", "varchar(100)", "Y"],
                    ["data_value", "numeric(12,5)", "N"]
                ];
                for (let i = 0; i < 3; i++) {
                    table.addRow(...cellContent[i])
                };
                designer.flush();
            });

            $(".drop-table").click(function(){
                designer.dropTableByTableName(designer.selectedTableName);
            });
        }
    </script>
</body>

</html>